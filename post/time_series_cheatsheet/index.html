<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=theme-color content="dark">
<title>Time Series Cheatsheet | Sanggiya</title>
<meta property="og:site_name" content="Hugo Tania is Amazing">
<meta property="og:title" content="Time Series Cheatsheet | Sanggiya">
<meta itemprop=name content="Time Series Cheatsheet | Sanggiya">
<meta name=twitter:title content="Time Series Cheatsheet | Sanggiya">
<meta name=application-name content="Time Series Cheatsheet | Sanggiya"><meta name=twitter:card content="summary">
<meta name=description content="Hugo is Absurdly Fast!">
<meta name=twitter:description content="Hugo is Absurdly Fast!">
<meta itemprop=description content="Hugo is Absurdly Fast!">
<meta property="og:description" content="Hugo is Absurdly Fast!">
<meta property="og:type" content="article">
<meta property="article:publisher" content="Hugo Tania">
<meta property="og:article:published_time" content="2022-02-19T00:00:00Z">
<meta property="article:published_time" content="2022-02-19T00:00:00Z">
<meta property="og:article:author" content="Rui">
<meta property="article:author" content="Rui">
<meta name=author content="Rui">
<script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"Time Series Cheatsheet","author":{"@type":"Person","name":"Hugo Tania"},"datePublished":"2022-02-19","description":"","wordCount":523,"mainEntityOfPage":"True","dateModified":"2022-02-19","publisher":{"@type":"Organization","name":"Hugo Tania","logo":{"@type":"imageObject","url":"https:\/\/srivendare.github.io\/favicon.ico"}}}</script>
<link rel="shortcut icon" type=image/x-icon href=/favicon.ico>
<link rel=stylesheet href=/sass/main.min.ab99ff095f832511e24ffb2fba2b51ad473b2f7e9301d674eba2c6c3a6e8bd81.css>
</head>
<script>(function(){const a='ThemeColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='ThemeColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.documentElement.dataset.userColorScheme='dark':document.documentElement.dataset.userColorScheme='light'})()</script>
<body class=dark>
<nav class=navbar>
<div class=container>
<div class=flex>
<div>
<a class=brand href=/>
<span class=emoji>
ðŸ¥¯
</span>
Sanggiya
</a>
</div>
<div class=flex>
<a href=/articles/>Tags</a>
<button id=dark-mode-button><svg class="light" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform:rotate(360deg);-webkit-transform:rotate(360deg);transform:rotate(360deg)" viewBox="0 0 36 36"><path fill="#ffd983" d="M30.312.776C32 19 20 32 .776 30.312c8.199 7.717 21.091 7.588 29.107-.429C37.9 21.867 38.03 8.975 30.312.776z"/><path d="M30.705 15.915a1.163 1.163.0 101.643 1.641 1.163 1.163.0 00-1.643-1.641zm-16.022 14.38a1.74 1.74.0 000 2.465 1.742 1.742.0 100-2.465zm13.968-2.147a2.904 2.904.0 01-4.108.0 2.902 2.902.0 010-4.107 2.902 2.902.0 014.108.0 2.902 2.902.0 010 4.107z" fill="#ffcc4d"/><rect x="0" y="0" width="36" height="36" fill="rgba(0, 0, 0, 0)"/></svg><svg class="dark" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform:rotate(360deg);-webkit-transform:rotate(360deg);transform:rotate(360deg)" viewBox="0 0 36 36"><path fill="#ffd983" d="M16 2s0-2 2-2 2 2 2 2v2s0 2-2 2-2-2-2-2V2zm18 14s2 0 2 2-2 2-2 2h-2s-2 0-2-2 2-2 2-2h2zM4 16s2 0 2 2-2 2-2 2H2s-2 0-2-2 2-2 2-2h2zm5.121-8.707s1.414 1.414.0 2.828-2.828.0-2.828.0L4.878 8.708s-1.414-1.414.0-2.829c1.415-1.414 2.829.0 2.829.0l1.414 1.414zm21 21s1.414 1.414.0 2.828-2.828.0-2.828.0l-1.414-1.414s-1.414-1.414.0-2.828 2.828.0 2.828.0l1.414 1.414zm-.413-18.172s-1.414 1.414-2.828.0.0-2.828.0-2.828l1.414-1.414s1.414-1.414 2.828.0.0 2.828.0 2.828l-1.414 1.414zm-21 21s-1.414 1.414-2.828.0.0-2.828.0-2.828l1.414-1.414s1.414-1.414 2.828.0.0 2.828.0 2.828l-1.414 1.414zM16 32s0-2 2-2 2 2 2 2v2s0 2-2 2-2-2-2-2v-2z"/><circle fill="#ffd983" cx="18" cy="18" r="10"/><rect x="0" y="0" width="36" height="36" fill="rgba(0, 0, 0, 0)"/></svg>
</button>
</div>
</div>
</div>
</nav>
<main>
<div class=container>
<article>
<header class=article-header>
<div class=thumb>
<div>
<h1>Time Series Cheatsheet</h1>
<div class=post-meta>
<div>
By Rui | <time>February 19, 2022</time>
| 3 minutes
</div>
<div class=tags>
</div>
</div>
</div>
</div>
</header>
</article>
<div class=article-post>
<p>This article aims to provide some pre-fabricated functions for time series analysis. After a dedication in Time Series field for past few months, I found it is good for getting some structual knowledge recorded.</p>
<p>Through extensive projects and refinement, I have crafted a collection of functions that aim to streamline the process of analyzing temporal patterns, identifying trends, and extracting meaningful insights from time series datasets.</p>
<p>In real work, I use these function to deliver fast results, although the basic notion can be easily forget sometimes : )</p>
<p>Basic required libraries:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=c1># For data manipulation</span>
<span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
<span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>

<span class=c1># To fetch financial data</span>
<span class=kn>import</span> <span class=nn>yfinance</span> <span class=k>as</span> <span class=nn>yf</span>

<span class=c1># For visualisation</span>
<span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</code></pre></td></tr></table>
</div>
</div><p>Plotting Moving Avg.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=k>def</span> <span class=nf>plotMovingAvg</span><span class=p>(</span><span class=n>series</span><span class=p>,</span> <span class=n>window</span><span class=p>,</span> <span class=n>scale</span> <span class=o>=</span> <span class=mf>1.96</span><span class=p>,</span> <span class=n>plot_intervals</span> <span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>anomalies</span> <span class=o>=</span> <span class=kc>False</span><span class=p>):</span>
    <span class=s2>&#34;&#34;&#34;
</span><span class=s2>        series - time indexed dataframe 
</span><span class=s2>        window - rolling window size (days)
</span><span class=s2>
</span><span class=s2>    &#34;&#34;&#34;</span>
    <span class=c1># by_day_stage = series</span>
    <span class=c1># by_day_stage[&#39;timestamp&#39;] = series.index</span>
    <span class=c1># by_day_stage[&#39;date&#39;] = series.apply(lambda x:str(x[&#39;timestamp&#39;]).split()[0], axis=1)</span>
    <span class=c1># by_day = by_day_stage.groupby(by=&#39;date&#39;).agg({&#39;open&#39;: &#39;mean&#39;})</span>
    <span class=n>rolling_mean</span> <span class=o>=</span> <span class=n>series</span><span class=o>.</span><span class=n>rolling</span><span class=p>(</span><span class=n>window</span><span class=o>=</span><span class=n>window</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
    
    <span class=n>fig</span><span class=p>,</span> <span class=n>ax</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>16</span><span class=p>,</span><span class=mi>9</span><span class=p>))</span>
    <span class=n>ax</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>series</span><span class=p>[</span><span class=n>window</span><span class=p>:],</span> <span class=n>label</span><span class=o>=</span><span class=s2>&#34;Actual values&#34;</span><span class=p>)</span>
    <span class=n>ax</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>rolling_mean</span><span class=p>,</span> <span class=n>label</span> <span class=o>=</span> <span class=s1>&#39;MA&#39;</span><span class=p>)</span>
    <span class=n>ax</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s2>&#34;Moving average</span><span class=se>\n</span><span class=s2> window size = </span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>window</span><span class=p>))</span>
    

    <span class=c1># plot intervals</span>
    <span class=k>if</span> <span class=n>plot_intervals</span><span class=p>:</span>
        <span class=n>mae</span> <span class=o>=</span> <span class=n>mean_absolute_error</span><span class=p>(</span><span class=n>series</span><span class=p>[</span><span class=n>window</span><span class=p>:],</span> <span class=n>rolling_mean</span><span class=p>[</span><span class=n>window</span><span class=p>:])</span>
        <span class=n>deviation</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>std</span><span class=p>(</span><span class=n>series</span><span class=p>[</span><span class=n>window</span><span class=p>:]</span> <span class=o>-</span> <span class=n>rolling_mean</span><span class=p>[</span><span class=n>window</span><span class=p>:])</span>
        <span class=n>lower_bond</span> <span class=o>=</span> <span class=n>rolling_mean</span> <span class=o>-</span> <span class=p>(</span><span class=n>mae</span> <span class=o>+</span> <span class=n>scale</span> <span class=o>*</span> <span class=n>deviation</span><span class=p>)</span>
        <span class=n>upper_bond</span> <span class=o>=</span> <span class=n>rolling_mean</span> <span class=o>+</span> <span class=p>(</span><span class=n>mae</span> <span class=o>+</span> <span class=n>scale</span> <span class=o>*</span> <span class=n>deviation</span><span class=p>)</span>
        <span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>upper_bond</span><span class=p>,</span> <span class=s2>&#34;r--&#34;</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s2>&#34;Upper Bond / Lower Bond&#34;</span><span class=p>)</span>
        <span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>lower_bond</span><span class=p>,</span> <span class=s2>&#34;r--&#34;</span><span class=p>)</span>

        <span class=c1># plot abnormals</span>
        <span class=c1># Having the intervals, find abnormal values</span>
        <span class=k>if</span> <span class=n>anomalies</span><span class=p>:</span>
            <span class=n>anomalies</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>index</span><span class=o>=</span><span class=n>series</span><span class=o>.</span><span class=n>index</span><span class=p>,</span> <span class=n>columns</span><span class=o>=</span><span class=n>series</span><span class=o>.</span><span class=n>columns</span><span class=p>)</span>
            <span class=n>anomalies</span><span class=p>[</span><span class=n>series</span><span class=o>&lt;</span><span class=n>lower_bond</span><span class=p>]</span> <span class=o>=</span> <span class=n>series</span><span class=p>[</span><span class=n>series</span><span class=o>&lt;</span><span class=n>lower_bond</span><span class=p>]</span>
            <span class=n>anomalies</span><span class=p>[</span><span class=n>series</span><span class=o>&gt;</span><span class=n>upper_bond</span><span class=p>]</span> <span class=o>=</span> <span class=n>series</span><span class=p>[</span><span class=n>series</span><span class=o>&gt;</span><span class=n>upper_bond</span><span class=p>]</span>
            <span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>anomalies</span><span class=p>,</span> <span class=s2>&#34;ro&#34;</span><span class=p>,</span> <span class=n>markersize</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span>
</code></pre></td></tr></table>
</div>
</div><p>Example Plotting</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>plotMovingAvg</span><span class=p>(</span><span class=n>test_df</span><span class=p>,</span> <span class=mi>480</span><span class=p>,</span> <span class=n>plot_intervals</span> <span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>anomalies</span> <span class=o>=</span> <span class=kc>True</span><span class=p>)</span>
</code></pre></td></tr></table>
</div>
</div><p>Export Results</p>
<p><img loading=lazy src=https://www.kaggleusercontent.com/kf/50985180/eyJhbGciOiJkaXIiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0..zWIu3Foz2bx7F5TZJvnBOw.KicB2tc55Yyj2ENgh8_xyBQu5e1NyyKNWFXFotqQi0s_imP2w3_fBkUy1EAV-Vzew329veiUgDPf2Aa30zp2eR_0Kphh48zLCybbHaxvNcYPqWGi4AIaXqjzUVL2qkm5NahS9wsPN83tWU_M0UphVCe_1rI4vGi__6_C_9jOaH94nKz5U0d9R95NPT-n6qu3e6P_7wAIgClnXJeoikfQInJaa8QkLnTIWNhspOW9FHTZSYYA0Sv1jAlNAohRlDIGNVoxrAvZSGorCYcB6loKjAwCSCf4mOF_dHK_zYw4wCFGJcSQJTlO6hnAz3Ys32gIoj01GPJ4wYEMHJ_Ymq3GGK94Mpj5lFD_MY4SqKb5YLBwHhVNW-Eag5dmE6MAVjOpw4w8lvIUe8tvKcAZog7r3Yz6c9ICFTWBqup2KYL8qOw1dlt4x8LaL0qzCQqoR1vgF0_L3rLixAW4QEOCDJ9qW7uF74eQ8ACGUUVle8ckXTsOk8F0vscNUoaSGJOolUj66y3xLo-IzV-uh-hNtILV4PxW-Dcp667OJtXEGFhabVmRfebE4L8-XIkL319hWpy1h7VDfzv0mg7k0WNLjZNXVloNmWsdGLAx06JqeFBj4p1cEDO7yRptfeNQUt_IVErbY9VvjH68AkfR185PpcFQDBZMsL1e1soFu1jl8O9O1ayGVnW1KrjYSCUzwauH54X0.kV9fJzFZfF6k_gHJ0usF6A/__results___files/__results___35_0.png alt=img></p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=k>def</span> <span class=nf>plotModelResults</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>X_train</span><span class=o>=</span><span class=n>X_train</span><span class=p>,</span> <span class=n>X_test</span><span class=o>=</span><span class=n>X_test</span><span class=p>,</span> <span class=n>plot_intervals</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>plot_anomalies</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
    <span class=s2>&#34;&#34;&#34;
</span><span class=s2>        Plots modelled vs fact values, prediction intervals and anomalies
</span><span class=s2>    
</span><span class=s2>    &#34;&#34;&#34;</span>
    
    <span class=n>prediction</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>X_test</span>
    <span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>15</span><span class=p>,</span> <span class=mi>7</span><span class=p>))</span>
        <span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>prediction</span><span class=p>,</span> <span class=s2>&#34;g&#34;</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s2>&#34;prediction&#34;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mf>2.0</span><span class=p>)</span>
        <span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>y_test</span><span class=o>.</span><span class=n>values</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s2>&#34;actual&#34;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mf>2.0</span><span class=p>)</span>

        <span class=k>if</span> <span class=n>plot_intervals</span><span class=p>:</span>
            <span class=n>cv</span> <span class=o>=</span> <span class=n>cross_val_score</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>X_train</span><span class=p>,</span> <span class=n>y_train</span><span class=p>,</span> 
                                        <span class=n>cv</span><span class=o>=</span><span class=n>tscv</span><span class=p>,</span> 
                                        <span class=n>scoring</span><span class=o>=</span><span class=s2>&#34;neg_mean_absolute_error&#34;</span><span class=p>)</span>
            <span class=n>mae</span> <span class=o>=</span> <span class=n>cv</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span> <span class=o>*</span> <span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
            <span class=n>deviation</span> <span class=o>=</span> <span class=n>cv</span><span class=o>.</span><span class=n>std</span><span class=p>()</span>

            <span class=n>scale</span> <span class=o>=</span> <span class=mf>1.96</span>
            <span class=n>lower</span> <span class=o>=</span> <span class=n>prediction</span> <span class=o>-</span> <span class=p>(</span><span class=n>mae</span> <span class=o>+</span> <span class=n>scale</span> <span class=o>*</span> <span class=n>deviation</span><span class=p>)</span>
            <span class=n>upper</span> <span class=o>=</span> <span class=n>prediction</span> <span class=o>+</span> <span class=p>(</span><span class=n>mae</span> <span class=o>+</span> <span class=n>scale</span> <span class=o>*</span> <span class=n>deviation</span><span class=p>)</span>

            <span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>lower</span><span class=p>,</span> <span class=s2>&#34;r--&#34;</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s2>&#34;upper bond / lower bond&#34;</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.5</span><span class=p>)</span>
            <span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>upper</span><span class=p>,</span> <span class=s2>&#34;r--&#34;</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.5</span><span class=p>)</span>

            <span class=k>if</span> <span class=n>plot_anomalies</span><span class=p>:</span>
                <span class=n>anomalies</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=n>np</span><span class=o>.</span><span class=n>NaN</span><span class=p>]</span><span class=o>*</span><span class=nb>len</span><span class=p>(</span><span class=n>y_test</span><span class=p>))</span>
                <span class=n>anomalies</span><span class=p>[</span><span class=n>y_test</span><span class=o>&lt;</span><span class=n>lower</span><span class=p>]</span> <span class=o>=</span> <span class=n>y_test</span><span class=p>[</span><span class=n>y_test</span><span class=o>&lt;</span><span class=n>lower</span><span class=p>]</span>
                <span class=n>anomalies</span><span class=p>[</span><span class=n>y_test</span><span class=o>&gt;</span><span class=n>upper</span><span class=p>]</span> <span class=o>=</span> <span class=n>y_test</span><span class=p>[</span><span class=n>y_test</span><span class=o>&gt;</span><span class=n>upper</span><span class=p>]</span>
                <span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>anomalies</span><span class=p>,</span> <span class=s2>&#34;o&#34;</span><span class=p>,</span> <span class=n>markersize</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span> <span class=n>label</span> <span class=o>=</span> <span class=s2>&#34;Anomalies&#34;</span><span class=p>)</span>

        <span class=n>error</span> <span class=o>=</span> <span class=n>mean_absolute_percentage_error</span><span class=p>(</span><span class=n>prediction</span><span class=p>,</span> <span class=n>y_test</span><span class=p>)</span>
        <span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s2>&#34;Mean absolute percentage error </span><span class=si>{0:.2f}</span><span class=s2>%&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>error</span><span class=p>))</span>
        <span class=n>plt</span><span class=o>.</span><span class=n>legend</span><span class=p>(</span><span class=n>loc</span><span class=o>=</span><span class=s2>&#34;best&#34;</span><span class=p>)</span>
        <span class=n>plt</span><span class=o>.</span><span class=n>tight_layout</span><span class=p>()</span>
        <span class=n>plt</span><span class=o>.</span><span class=n>grid</span><span class=p>(</span><span class=kc>True</span><span class=p>);</span>
</code></pre></td></tr></table>
</div>
</div><p><img loading=lazy src=https://www.kaggleusercontent.com/kf/50985180/eyJhbGciOiJkaXIiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0..zWIu3Foz2bx7F5TZJvnBOw.KicB2tc55Yyj2ENgh8_xyBQu5e1NyyKNWFXFotqQi0s_imP2w3_fBkUy1EAV-Vzew329veiUgDPf2Aa30zp2eR_0Kphh48zLCybbHaxvNcYPqWGi4AIaXqjzUVL2qkm5NahS9wsPN83tWU_M0UphVCe_1rI4vGi__6_C_9jOaH94nKz5U0d9R95NPT-n6qu3e6P_7wAIgClnXJeoikfQInJaa8QkLnTIWNhspOW9FHTZSYYA0Sv1jAlNAohRlDIGNVoxrAvZSGorCYcB6loKjAwCSCf4mOF_dHK_zYw4wCFGJcSQJTlO6hnAz3Ys32gIoj01GPJ4wYEMHJ_Ymq3GGK94Mpj5lFD_MY4SqKb5YLBwHhVNW-Eag5dmE6MAVjOpw4w8lvIUe8tvKcAZog7r3Yz6c9ICFTWBqup2KYL8qOw1dlt4x8LaL0qzCQqoR1vgF0_L3rLixAW4QEOCDJ9qW7uF74eQ8ACGUUVle8ckXTsOk8F0vscNUoaSGJOolUj66y3xLo-IzV-uh-hNtILV4PxW-Dcp667OJtXEGFhabVmRfebE4L8-XIkL319hWpy1h7VDfzv0mg7k0WNLjZNXVloNmWsdGLAx06JqeFBj4p1cEDO7yRptfeNQUt_IVErbY9VvjH68AkfR185PpcFQDBZMsL1e1soFu1jl8O9O1ayGVnW1KrjYSCUzwauH54X0.kV9fJzFZfF6k_gHJ0usF6A/__results___files/__results___118_0.png alt=img></p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=k>def</span> <span class=nf>plotCoefficients</span><span class=p>(</span><span class=n>model</span><span class=p>):</span>
    <span class=s2>&#34;&#34;&#34;
</span><span class=s2>        Plots sorted coefficient values of the model
</span><span class=s2>    &#34;&#34;&#34;</span>
    
    <span class=n>coefs</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>model</span><span class=o>.</span><span class=n>coef_</span><span class=p>,</span> <span class=n>X_train</span><span class=o>.</span><span class=n>columns</span><span class=p>)</span>
    <span class=n>coefs</span><span class=o>.</span><span class=n>columns</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;coef&#34;</span><span class=p>]</span>
    <span class=n>coefs</span><span class=p>[</span><span class=s2>&#34;abs&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>coefs</span><span class=o>.</span><span class=n>coef</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>abs</span><span class=p>)</span>
    <span class=n>coefs</span> <span class=o>=</span> <span class=n>coefs</span><span class=o>.</span><span class=n>sort_values</span><span class=p>(</span><span class=n>by</span><span class=o>=</span><span class=s2>&#34;abs&#34;</span><span class=p>,</span> <span class=n>ascending</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span><span class=o>.</span><span class=n>drop</span><span class=p>([</span><span class=s2>&#34;abs&#34;</span><span class=p>],</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
    
    <span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>15</span><span class=p>,</span> <span class=mi>7</span><span class=p>))</span>
    <span class=n>coefs</span><span class=o>.</span><span class=n>coef</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>kind</span><span class=o>=</span><span class=s1>&#39;bar&#39;</span><span class=p>)</span>
    <span class=n>plt</span><span class=o>.</span><span class=n>grid</span><span class=p>(</span><span class=kc>True</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=s1>&#39;y&#39;</span><span class=p>)</span>
    <span class=n>plt</span><span class=o>.</span><span class=n>hlines</span><span class=p>(</span><span class=n>y</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>xmin</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>xmax</span><span class=o>=</span><span class=nb>len</span><span class=p>(</span><span class=n>coefs</span><span class=p>),</span> <span class=n>linestyles</span><span class=o>=</span><span class=s1>&#39;dashed&#39;</span><span class=p>);</span>

</code></pre></td></tr></table>
</div>
</div><p><img loading=lazy src=https://www.kaggleusercontent.com/kf/50985180/eyJhbGciOiJkaXIiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0..zWIu3Foz2bx7F5TZJvnBOw.KicB2tc55Yyj2ENgh8_xyBQu5e1NyyKNWFXFotqQi0s_imP2w3_fBkUy1EAV-Vzew329veiUgDPf2Aa30zp2eR_0Kphh48zLCybbHaxvNcYPqWGi4AIaXqjzUVL2qkm5NahS9wsPN83tWU_M0UphVCe_1rI4vGi__6_C_9jOaH94nKz5U0d9R95NPT-n6qu3e6P_7wAIgClnXJeoikfQInJaa8QkLnTIWNhspOW9FHTZSYYA0Sv1jAlNAohRlDIGNVoxrAvZSGorCYcB6loKjAwCSCf4mOF_dHK_zYw4wCFGJcSQJTlO6hnAz3Ys32gIoj01GPJ4wYEMHJ_Ymq3GGK94Mpj5lFD_MY4SqKb5YLBwHhVNW-Eag5dmE6MAVjOpw4w8lvIUe8tvKcAZog7r3Yz6c9ICFTWBqup2KYL8qOw1dlt4x8LaL0qzCQqoR1vgF0_L3rLixAW4QEOCDJ9qW7uF74eQ8ACGUUVle8ckXTsOk8F0vscNUoaSGJOolUj66y3xLo-IzV-uh-hNtILV4PxW-Dcp667OJtXEGFhabVmRfebE4L8-XIkL319hWpy1h7VDfzv0mg7k0WNLjZNXVloNmWsdGLAx06JqeFBj4p1cEDO7yRptfeNQUt_IVErbY9VvjH68AkfR185PpcFQDBZMsL1e1soFu1jl8O9O1ayGVnW1KrjYSCUzwauH54X0.kV9fJzFZfF6k_gHJ0usF6A/__results___files/__results___118_1.png alt=img></p>
<p>XGBoot Codes:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=kn>from</span> <span class=nn>xgboost</span> <span class=kn>import</span> <span class=n>XGBRegressor</span> 

<span class=n>xgb</span> <span class=o>=</span> <span class=n>XGBRegressor</span><span class=p>()</span>
<span class=n>xgb</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>X_train_scaled</span><span class=p>,</span> <span class=n>y_train</span><span class=p>)</span>

<span class=n>plotModelResults</span><span class=p>(</span><span class=n>xgb</span><span class=p>,</span> 
                 <span class=n>X_train</span><span class=o>=</span><span class=n>X_train_scaled</span><span class=p>,</span> 
                 <span class=n>X_test</span><span class=o>=</span><span class=n>X_test_scaled</span><span class=p>,</span> 
                 <span class=n>plot_intervals</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>plot_anomalies</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</code></pre></td></tr></table>
</div>
</div><p><img loading=lazy src=https://www.kaggleusercontent.com/kf/50985180/eyJhbGciOiJkaXIiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2In0..zWIu3Foz2bx7F5TZJvnBOw.KicB2tc55Yyj2ENgh8_xyBQu5e1NyyKNWFXFotqQi0s_imP2w3_fBkUy1EAV-Vzew329veiUgDPf2Aa30zp2eR_0Kphh48zLCybbHaxvNcYPqWGi4AIaXqjzUVL2qkm5NahS9wsPN83tWU_M0UphVCe_1rI4vGi__6_C_9jOaH94nKz5U0d9R95NPT-n6qu3e6P_7wAIgClnXJeoikfQInJaa8QkLnTIWNhspOW9FHTZSYYA0Sv1jAlNAohRlDIGNVoxrAvZSGorCYcB6loKjAwCSCf4mOF_dHK_zYw4wCFGJcSQJTlO6hnAz3Ys32gIoj01GPJ4wYEMHJ_Ymq3GGK94Mpj5lFD_MY4SqKb5YLBwHhVNW-Eag5dmE6MAVjOpw4w8lvIUe8tvKcAZog7r3Yz6c9ICFTWBqup2KYL8qOw1dlt4x8LaL0qzCQqoR1vgF0_L3rLixAW4QEOCDJ9qW7uF74eQ8ACGUUVle8ckXTsOk8F0vscNUoaSGJOolUj66y3xLo-IzV-uh-hNtILV4PxW-Dcp667OJtXEGFhabVmRfebE4L8-XIkL319hWpy1h7VDfzv0mg7k0WNLjZNXVloNmWsdGLAx06JqeFBj4p1cEDO7yRptfeNQUt_IVErbY9VvjH68AkfR185PpcFQDBZMsL1e1soFu1jl8O9O1ayGVnW1KrjYSCUzwauH54X0.kV9fJzFZfF6k_gHJ0usF6A/__results___files/__results___146_0.png alt=img></p>
</div>
</div>
<div class=container>
<nav class="flex container suggested">
<a rel=prev href=/post/extracting_info_from_struactual_data_source/ title="Previous post (older)">
<span>Previous</span>
Extracting Knowledge from Unstructual data
</a>
<a rel=next href=/post/time_series_evaluation/ title="Next post (newer)">
<span>Next</span>
ML Evaluation Indexes
</a>
</nav>
</div>
<div class=container>
</div>
</main>
</main>
<footer class="footer flex">
<section class=container>
<nav class=footer-links>
<a href=/index.xml>RSS</a>
</nav>
</section>
<script defer src=/ts/features.6bec993050976e7360ece802de9df50f61459197c14bd32823dc2d8da0ee964c.js data-enable-footnotes=true></script>
</footer>
</body>
</html>